<html>
    <script src='https://assets.onfido.com/web-sdk-releases/2.8.0/onfido.min.js'></script>
    <link rel='stylesheet' href='https://assets.onfido.com/web-sdk-releases/2.8.0/style.css'>
    <style>
        html, body {
          height: 100%;
          margin: 0;
        }

        body, button {
          -webkit-font-smoothing: antialiased;
        }

        @media (min-width: 30em) {
          #onfido-mount {
            position: relative;
            top: 10%;
          }

          .onfido-sdk-ui-Modal-inner {
            font-family: "Open Sans", sans-serif !important;
          }
        }
    </style>

    <body>

    <!-- At the bottom of your page, you need an empty element where the
    verification component will be mounted. -->
    <div id='onfido-mount'></div>

    </body>


    <script>

    // Call to retrieve the SDK token
    var request = new XMLHttpRequest();
    var theUrl = new URL(window.location.href);
    var applicantID = theUrl.searchParams.get("applicantID");
    console.log("applicantID = " + applicantID);

    var serverURL = theUrl.searchParams.get("serverURL");
    if (serverURL == null) {
        serverURL = "http://localhost:8080/v1/query";
    }
    console.log("serverURL = " + serverURL);

    var tokenRequest = {
        "query":"mutation { kycGenerateSdkToken(applicantID: \"" + applicantID + "\")}"
    }

    request.open('POST', serverURL, true);
    request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    request.send(JSON.stringify(tokenRequest));

    request.onload = function() {
      if (request.status >= 200 && request.status < 400) {
        var data = JSON.parse(request.responseText);
        var token = data.data.kycGenerateSdkToken;
        console.log("token = " + token);
        Onfido.init({
          useModal: false,
          token: token,
          onComplete: function(data) {
            // Callback to start the Onfido check.
            console.log(
                "everything is complete, calling to start check, data.face.variant = " + data.face.variant
            );
            var crequest = new XMLHttpRequest();
            var checkRequest = {
                "query":"mutation { kycCreateCheck(applicantID: \"" + applicantID + "\", facialVariant: \"" + data.face.variant +"\")}"
            }
            crequest.open('POST', serverURL, true);
            crequest.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            crequest.send(JSON.stringify(checkRequest));
            crequest.onload = function() {
                if (request.status >= 200 && request.status < 400) {
                    var cdata = JSON.parse(crequest.responseText);
                    console.log(cdata);
                    console.log(request.status + ", new check id = " + cdata.data.kycCreateCheck);
                }
            }
            crequest.send()
          },
          steps: [
            'welcome',
            'document',
            'face',
            'complete'
          ]
        });
      }
    }
    request.send()

    </script>
</html>
